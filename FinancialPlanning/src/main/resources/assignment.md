# Instruction

All the code for this assignment can be found in `FinancialPlanning/src/main/java/com/ortecfinance/financialplanning/` we will continue to build on the `Java` code in there. Background information for Amazon Alexa skills can be found here:

```
FinancialPlanning/src/main/resources/alexa-reference.md
``` 

# Project structure

A brief description of the project structure

## Source code

All the source code is in:

```
FinancialPlanning/src/main/java/com/ortecfinance/financialplanning/
```

## Tests

All the unit tests are in:

```
FinancialPlanning/src/main/test/java/com/ortecfinance/financialplanning/
```

_Hint: certain tests are ignored, they can safely be ignored for the first assignment but for the extra assignments they may prove useful. You can run them by removing the `@Ignore` annotation._

## Request flow:

1. The request will enter in the `FinancialPlanningSpeechlet` in the `onIntent(..)` method
2. The response will be generated by the `ResponseTextFactory` class
    1. It will store any user answers in the `Session` to remember them in the session
    2. It will then use the `NextQuestionFactory` to determine what question to ask next
3. The `EndSessionFactory` determines whether the conversation has finished (in which case the session should be ended)
4. The response is transformed to an object the Alexa API understands in the `ResponseFactory`

_Hint: All classes mentioned after step 1 will have to be updated when adding a new intent._

## Administrative parts

* The `AmazonIntents` includes all the intents defined by Amazon that we have to handle
* The `FinancialPlanningIntents` includes all our own intents that we have to handle
* The `intents.json` includes the model of the skill, including what the user has to say for Alexa to understand

_Hint: You do not have to update the `intents.json` unless you add your own ideas to the skill, at the start feel free to leave the `intents.json` as is._

## Calculation / modeling part

The very basic calculation / simulation is done in the `FeasibilityCalculator`, it is up to you to determine if you want to improve it or leave it as is.

# Assignment
 
The assignment starts here!

## Update Welcome message

We will start by updating the welcome message Alexa says when we start the skill:

1. Go to the `FinancialPlanningSpeechlet`
2. Update the welcome message

## Deploy & Test

1. Select `Build deployment` in the top right and click the play button.
    * You can skip unit tests with `Build deployment (skip tests)` and you can then still deploy on Alexa (no guarantees it will work though).
2. Go to Tools -> Update AWS Lambda | Java -> select <Echo name on sticker> and click update.
3. Test on your Echo by saying: "Alexa, start financial planning <Echo name on sticker>"

These steps have to be done for every code change in order to update your Alexa skill.

_Hint: if you update the welcome message before deploying you'll know the deploy worked!_

_Caution: you can skip the unit tests if you are stuck and want to test on Alexa directly instead of with unit tests, we don't mind. But you cannot debug the code that is running on Alexa, so troubleshooting will be more difficult._
 
## Improve a basic financial planner 

A basic financial planner has been implemented and is running on your Echo. It performs the following actions:

- Introduction to the app when you say "Alexa start financial planning <Echo name on sticker>"
- Alexa then asks you for your target amount
- Answer an amount (see `FinancialPlanning/src/main/resources/intents.json` for sample phrases)
- Alexa then asks you for your monthly deposit
- Answer an amount
- Alexa then asks you for your time to target (number of months)
- Answer an amount 
- Alexa provides a feasibility of High or Low (based on your answers)

You are going to expand the code to be able to ask for an initial amount, after that expansion the basic conversation of a financial planner is ready.

### The `SetInitialSavingsIntent` Intent

First look at the intents.json:

```
FinancialPlanning/src/main/resources/intents.json
```

We have already added the intent to the JSON but the intent below it is not yet handled by the `Speechlet`:

```
{
  "name": "SetInitialSavingsIntent",
  "slots": [
    {
      "name": "InitialSavings",
      "type": "AMAZON.NUMBER"
    }
  ],
  "samples": [
    "my initial savings are {InitialSavings}",
    "savings are {InitialSavings}",
    "my current savings are {InitialSavings}"
  ]
}
```

We have to add code to handle this `SetInitialSavings` intent by following the steps below.

### Verify the current code can be build
First verify that the code compiles and all tests are working by selecting `Run all Tests` in the top right of IntelliJ and clicking the play button next to it. 
   

### Adding intent

Add an intent to `FinancialPlanningIntents` with the value `SetInitialSavingsIntent`.

### Add a question

Next add a question to the `FinancialPlanningSpeechlet`: "How much have you currently saved?". Also add a key here with the value `InitialSavings`.

### Update the code that handles the question and response

Now update the following files: `EndSessionFactory`, `NextQuestionFactory` and `ResponseTextFactory` 
with the newly created constants. The new functionality should be very similar to the goal amount functionality.

_Hint: adding it *after* the other existing intents and questions will make updating the tests easier, make sure to add it *after*
the other intents/questions!_  

### Add unit tests that verify the updated code

Now expand the test in line with your new code: `EndSessionFactoryTest`, `NextQuestionFactoryTest` 
and `ResponseTextFactoryTest`.

Run the tests again (by selecting `Run all Tests` in the top right of IntelliJ and clicking the play button next to it).

### Unit test problems

If you run into problems while running the unit tests, verify the order of the questions did not change, because changing the order
will make updating the unit tests much harder. If you are stuck you can also skip the unit tests and deploy immediately,
no guarantee that it will actually work though.

_Hint: the Deploy & Test instructions include a method for deploying without running unit tests, feel free to use it if you are stuck._

### Deploy

Deploy the code! (Follow the Deploy & Test instructions)

# Extra additions

Since you have a basic working solution now, here are several ideas on how to improve the current skill you have. You can do them in any order.

## Extra: Better UX through dynamic numbers
Enable Alexa to understand it if you only provide a number for each question instead of full utterances. See the ignored test in `FinancialPlanningSpeechletTest` for an example conversation your skill would have to handle. Once this is done users can simply answer in only numbers, instead of constantly uttering the full phrases.

Example conversation:

```
Alexa: What is the amount you need to achieve your financial goal?
User: 20 000
Alexa: What will your monthly contribution be? 
User: 200
Alexa: How many months are left until the goal is achieved?
User: 68
```
_Note: in this approach all numbers uttered by the user map to the `SET_DYNAMIC_NUMBER_INTENT`, you will have to figure out a way to decide what question the user answered, it could be any of the four questions._

_Hint: take a look at the `DynamicNumberKeyFactory`, it includes a crucial part of the puzzle._

_Starting point: in the first assignment the `SetInitialSavingsIntent` was added and handled, in this assignment you will have to start handling the `SetDynamicNumberIntent`. Start by adding the `SetDynamicNumberIntent` in all the different places you added the 'SetInitialSavingsIntent'._

## Extra: Better feasibility calculation

Alexa can only give two verdicts: High and Low. The answer is based on whether the expected end result (based on a 2.75% average return) is higher or lower than the target.

Extend the range of possible answers to four by also comparing with 1.5% and a 3.75% scenario.

_Note: Update the `FeasibilityCalculator` class with extra logic. You also need to update the unit tests in the `FeasibilityCalculatorTest` class._

## Extra: Advanced financial planning conversation

Instead of stopping after the calculation, add the option to fix a low feasibility. Use three possible options to make the goal feasible:
 
* Lower the goal 
* Increase the monthly deposit
* Increase the time to target (a longer period should yield a higher feasibility) 

_Note: you will need to add your own intents here, update the `intents.json` and the `Java` code to handle the extra intents. We can update the `intents.json` file for you once you are ready._

_Starting point: in the first assignment the `SetInitialSavingsIntent` was added and handled, in this extra assignment you will essentially have to repeat the process with the intents listed above._

## Extra: Your own idea

Feel free to improve on the current skill with your own idea's, the goal is to create a skill that helps people achieve their financial goals, in this extra you get total freedom to achieve that goal.

_Note: you will need to add your own intents here, update the `intents.json` and the `Java` code to handle the extra intents. We can update the `intents.json` file for you once you are ready._ 

### Example extra intent:

Below is an example of an added Intent called `YourExtraIntent` in the `intents.json`:

``` 
{
  "interactionModel": {
    "languageModel": {
      "invocationName": "financial planning",
      "intents": [
        {
          "name": "FinancialPlanningIntent",
          "slots": [],
          "samples": [
            "help me achieve my financial goals",
            "help achieve goals",
            "financial goals"
          ]
        },
        ...
        {
          "name": "YourExtraIntent",
          "slots": [],
          "samples": [
            "Here is my extra intent",
            "Use my extra intent",
            "Please perform my extra intent"
          ]          
        }
      ],
      "types": []
    }
  }
}
```

If you want your skill to handle extra phrases, any phrases, you will also need to modify the `intents.json` with your extra intent.

The file can be found here:

```
./FinancialPlaning/src/main/resources/speechassets/intents.json
```

After the update we will have to upload it to AWS for you, please let us know if you want to update it.